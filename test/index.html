<html>
<head>
  <meta charset="UTF-8">
  <script src="../node_modules/jquery/dist/jquery.min.js"></script>
  <script src="../dist/jquery-nested-form.js"></script>
</head>
<body>
  <h1>Basic Form</h1>
  <form>
    <div id="container">
      <div class="nested-form">
        <p><input type="text" name="basic_attributes[0][text]" id="basic_attributes_0_text"></p>
        <p><textarea name="basic_attributes[0][textarea]" id="basic_attributes_0_textarea"></textarea></p>
        <p>
          <select name="basic_attributes[0][select]" id="basic_attributes_0_select">
            <option value=""></option>
            <option value="opt1">opt1</option>
            <option value="opt2">opt2</option>
          </select>
        </p>
        <p>
          <input type="hidden" name="basic_attributes[0][radio]" value="">
          <input type="radio" value="1" name="basic_attributes[0][radio]" id="basic_attributes_0_radio_1">
          <label for="basic_attributes_0_radio_1">radio1</label>
          <input type="radio" value="2" name="basic_attributes[0][radio]" id="basic_attributes_0_radio_2">
          <label for="basic_attributes_0_radio_2">radio2</label>
        </p>
        <p>
          <input name="basic_attributes[0][checkbox]" type="hidden" value="0">
          <input type="checkbox" value="1" name="basic_attributes[0][checkbox]" id="basic_attributes_0_checkbox">
          <label for="basic_attributes_0_checkbox">Checkbox</label>
        </p>
        <input type="hidden" value="999" name="basic_attributes[0][id]" id="basic_attributes_0_id">
      </div>
    </div>
    <input type="button" value="Add" id="add">
  </form>
  <script>
  $('#container').nestedForm({
    forms: '#container .nested-form',
    adder: '#add'
  });
  </script>

  <h1>Removable Form</h1>
  <form>
    <div id="removable_container">
      <div class="nested-form">
        <p>
          <input type="text" name="removable_attributes[0][text]" id="removable_attributes_0_text">
        </p>
      </div>
      <div class="nested-form">
        <p>
          <input type="text" name="removable_attributes[1][text]" id="removable_attributes_1_text">
          <input type="hidden" name="removable_attributes[1][_destroy]" id="removable_attributes_1__destroy">
          <input type="button" value="Remove" class="removable-remove">
        </p>
      </div>
    </div>
    <input type="button" value="Add" id="removable_add">
  </form>
  <script>
  $('#removable_container').nestedForm({
    forms: '#removable_container .nested-form',
    adder: '#removable_add',
    remover: '.removable-remove'
  });
  </script>

  <h1>Callback</h1>
  <form>
    <div id="callback_container">
      <div class="nested-form">
        <p>
          <input type="text" name="callback_attributes[0][text]" id="callback_attributes_0_text">
          <input type="button" value="Remove" class="callback-remove">
        </p>
      </div>
    </div>
    <input type="button" value="Add" id="callback_add">
    <p id="message"> </p>
  </form>
  <script>
  $('#callback_container').nestedForm({
    forms: '#callback_container .nested-form',
    adder: '#callback_add',
    remover: '.callback-remove',
    afterInitialize: function(instance) {
      $('#message').append('afterInitialize ');
    },
    onBuildTemplate: function($template) {
      $('#message').append('onBuildTemplate ');
    },
    onBuildForm: function($elem) {
      $('#message').append('onBuildForm ');
    },
    beforeAddForm: function($container, $elem) {
      $('#message').append('beforeAddForm ');
    },
    afterAddForm: function($container, $elem) {
      $('#message').append('afterAddForm ');
    },
    beforeRemoveForm: function($container, $elem) {
      $('#message').append('beforeRemoveForm ');
    },
    afterRemoveForm: function($container, $elem) {
      $('#message').append('afterRemoveForm ');
    }
  });
  </script>

  <h1>Customize start index</h1>
  <form>
    <div id="index_container">
      <div class="nested-form">
        <p>
          <input type="text" name="index_attributes[10][text]" id="index_attributes_10_text">
        </p>
      </div>
    </div>
    <input type="button" value="Add" id="index_add">
  </form>
  <script>
  $('#index_container').nestedForm({
    forms: '#index_container .nested-form',
    adder: '#index_add',
    increment: 3,
    startIndex: 10,
    maxIndex: 15,
    onBuildForm: function($elem, index) {
      $elem.find('input[type="text"]').val(index);
    }
  });
  </script>

  <h1>Multiple associations</h1>
  <form>
    <div id="multiple_container">
      <div class="nested-form">
        <p>
          <input type="text" name="some_attributes[0][text]" id="some_attributes_0_text">
        </p>
        <p>
          <input type="text" name="other_attributes[0][text]" id="other_attributes_0_text">
        </p>
      </div>
    </div>
    <input type="button" value="Add" id="multiple_add">
  </form>
  <script>
  $('#multiple_container').nestedForm({
    forms: '#multiple_container .nested-form',
    adder: '#multiple_add',
    associations: ['some', 'other'],
    onBuildForm: function($elem) {
      showID($elem);
    }
  });
  </script>

  <h1>Complex Form</h1>
  <form>
    <div id="complex_container">
      <div class="nested-form">
        <input type="text" name="item[base_attributes][0][text]" id="item_base_attributes_0_text" style="width: 300px;">
        <div class="deep-container">
          <div class="deep-nested-form">
            <input type="text" name="item[base_attributes][0][deep_attributes][0][text1]" id="item_base_attributes_0_deep_attributes_0_text1" style="width: 400px;">
            <input type="text" name="item[base_attributes][0][deep_attributes][0][text2]" id="item_base_attributes_0_deep_attributes_0_text2" style="width: 400px;">
          </div>
        </div>
        <input type="button" value="Add" class="deep-add">
      </div>
    </div>
    <hr>
    <input type="button" value="Add" id="complex_add">
  </form>
  <script>
  $('#complex_container').nestedForm({
    forms: '#complex_container .nested-form',
    adder: '#complex_add',
    associations: ['base'],
    cloneEvents: false,
    onBuildForm: function($elem) {
      initDeepNestedForm($elem.find('.deep-container'));
      showID($elem);
    }
  });
  initDeepNestedForm($('#complex_container .deep-container'));

  function showID($elem) {
    $elem.find('input[type="text"]').each(function(i, input) {
      $(input).val($(input).attr('id'));
    });
  }
  function initDeepNestedForm($container) {
    $container.nestedForm({
      forms: $container.find('.deep-nested-form'),
      adder: $container.siblings('.deep-add'),
      associations: ['deep'],
      cloneEvents: false,
      onBuildForm: function($elem) {
        showID($elem);
      }
    });
  }
  </script>
</body>
</html>
